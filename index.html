<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>弹幕-。-</title>
	<style>
		*{
			margin: 0;
			padding: 0;
			font-family: '微软雅黑';
			box-sizing: border-box;
			list-style: none;
		}
		body{
			background-color: #ccc;
		}
		.clearfix:after{
			display:block;
			clear:both;
			content:"";
			visibility:hidden;
			height:0
		}
		h1{
			text-align: center;
			margin: 200px 0 30px 0;
		}
		.container{
			display: flex;
			width: 900px;
			height: 456px;
			margin: 0 auto;
			background-color: #fff;
		}
		.barrageShow{
			float: left;
			width: 70%;
		}
		.barrageList{
			float: right;
			width: 30%;
		}
		.screen{
			position: relative;
			height: 400px;
			background-color: #888;
			overflow: hidden;
			padding: 5px 0;
		}
		.barrageInput{
			padding: 10px 20px;
			background-color: #333;
		}
		.barrageInput input{
			border: none;
			font-size: 20px;
			padding: 5px 10px;
			border-radius: 1rem;
			outline: none;
			width: 77%;
		}
		.barrageInput button{
			width: 20%;
			float: right;
			font-size: 20px;
			border-radius: 1rem;
			border: none;
			padding: 5px 0;
			outline: none;
			cursor: pointer;
		}
		.barrageList{
			display: flex;
			 flex-direction:column;
		}
		.list-title{
			text-align: center;
			color: #fff;
			background-color: #333;
			font-size: 20px;
			line-height: 40px;
		}
		.list-content{
			flex: 1;
			overflow-y: auto;
		}
		.list-content ul li{
			padding: 5px 10px; 
			color: gray;
		}
		.list-content ul li span{
			float: right;
			width: 30%;
			text-align: center;
		}
		.list-content ul li p{
			display: inline-block;
			width: 70%;
			white-space:nowrap; 
			overflow: hidden; /*自动隐藏文字*/
		    text-overflow: ellipsis;/*文字隐藏后添加省略号*/
		}
		.screen p{
			position: absolute;
			left: -300px;
			animation: Bscreen 8s linear  alternate;
			font-size: 20px;
			white-space:nowrap;
		}
		@keyframes Bscreen
		{
		    0%{
		    	left: 630px;
		    }
		    100%{
		    	left: -300px;
		    }
		}
	</style>
</head>
<body>
	<h1>Barrage-弹幕</h1>
	<div class="container clearfix">
		<div class="barrageShow">
			<div class="screen" id="Bscreen"></div>
			<div class="barrageInput">
				<input type="text" placeholder="请输入弹幕吧=。=" maxlength="15">
				<button id="btn">发射</button>
			</div>
		</div>
		<div class="barrageList">
			<div class="list-title">Barrage-List</div>
			<div class="list-content">
				<ul id="list-list"></ul>
			</div>
		</div>
	</div>
	<script>
		var btn = document.getElementById('btn');
		var text = document.getElementsByTagName('input')[0];
		console.log(text.value);

		//焦点在input时键盘enter和btn绑定
		text.onfocus = function() {
			document.onkeydown = function(e) {
				if(!e) {
					e = window.event;
				}
				if((e.keyCode || e.which) == 13) {
					btn.click();
				}
			}
		}
		//input失去焦点时enter解绑
		text.onblur = function() {
			document.onkeydown = function(e) {
				if(!e) {
					e = window.event;
				}
				if((e.keyCode || e.which) == 13) {
					return false;
				}
			}
		}
		//点击发射按钮发送弹幕
		btn.onclick = function() {
			//判断输入为空时提醒输入
			var space  = /^[\s]*$/;
			if(text.value == '' || space.test(text.value)) {
				alert('请输入弹幕内容QAQ=。=');
				return false;
			}
			//生成个节点进行appendChild
			var ulNode = document.getElementById('list-list');
			var screen = document.getElementById('Bscreen');
			var liNode = document.createElement('LI');
			var pNode = document.createElement('P');
			var BpNode = document.createElement('P');
			var randomColor = ['red','white','green','blue','yellow'];
			var randomnum = Math.random() * 90;
			BpNode.style.color = randomColor[Math.floor(Math.random() * 5)];
			BpNode.style.top = randomnum + '%';
			var spanNode = document.createElement('SPAN');
			var textNode = document.createTextNode(text.value);
			var BtextNode = document.createTextNode(text.value);
			console.log(textNode);
			var pDate = new Date();
			var pH = pDate.getHours();
			var pM = pDate.getMinutes();
			var pS = pDate.getSeconds();

			if(pM < 10) {
				pM ='0'+ pM;
			}
			if(pS < 10) {
				pS ='0'+ pS;
			}
			var Blist = document.getElementsByClassName('list-content')[0];
			var timeNode = document.createTextNode(pH + ":" + pM + ":" + pS);
			console.log(timeNode);
			pNode.appendChild(textNode);
			spanNode.appendChild(timeNode);
			liNode.appendChild(pNode);
			liNode.appendChild(spanNode);
			ulNode.appendChild(liNode);
			BpNode.appendChild(BtextNode);
			Bscreen.appendChild(BpNode);
			setTimeout('Bscreen.removeChild(Bscreen.childNodes[0]);',8000);
			//滚动条置底
			Blist.scrollTop = Blist.scrollHeight;
			//发送完成input的value值重置为空
			text.value ='';
		}
	</script>
</body>
</html>